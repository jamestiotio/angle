<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1320" height="1070"><source><![CDATA[participant App
participant "ANGLE Front-end"
participant "Vulkan Back-end"
participant "ANGLE Translator"
participant "Link-Time SPIR-V Transformer"

App->"ANGLE Front-end": glCompileShader (VS)
"ANGLE Front-end"->"Vulkan Back-end": ShaderVk::compile
"Vulkan Back-end"->"ANGLE Translator": sh::Compile
"ANGLE Translator"-->"ANGLE Front-end": return SPIR-V

Note right of "ANGLE Front-end": SPIR-V is using bogus\ndecorations to be\ncorrected at link time.

Note right of App: Same for FS, GS, etc...

App->"ANGLE Front-end": glCreateProgram (...)
App->"ANGLE Front-end": glAttachShader (...)
App->"ANGLE Front-end": glLinkProgram
"ANGLE Front-end"->"Vulkan Back-end": ProgramVk::link

Note right of "Vulkan Back-end": ProgramVk inits uniforms,\nlayouts, and descriptors.

"Vulkan Back-end"->"Link-Time SPIR-V Transformer": SpvGetShaderSpirvCode
"Link-Time SPIR-V Transformer"-->"Vulkan Back-end": retrieve SPIR-V and determine decorations
"Vulkan Back-end"-->"ANGLE Front-end": return success

Note right of App: App execution continues...

App->"ANGLE Front-end": glDrawArrays (any draw)
"ANGLE Front-end"->"Vulkan Back-end": ContextVk::drawArrays

"Vulkan Back-end"->"Link-Time SPIR-V Transformer": SpvTransformSpirvCode
"Link-Time SPIR-V Transformer"-->"Vulkan Back-end": return transformed SPIR-V

Note right of "Vulkan Back-end": We init VkShaderModules\nand VkPipeline then\nrecord the draw.

"Vulkan Back-end"-->"ANGLE Front-end": return success
]]></source><desc/><defs><marker id="markerArrowBlock" markerHeight="5" markerWidth="5" orient="auto" refX="5" refY="2.5" viewBox="0 0 5 5"><path d="M 0 0 L 5 2.5 L 0 5 z"/></marker><marker id="markerArrowOpen" markerHeight="16" markerWidth="4" orient="auto" refX="9.6" refY="8" viewBox="0 0 9.6 16"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"/></marker></defs><g class="actor"><rect width="48.813" height="37.6" x="10" y="20" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="20" y="43.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="20">App</tspan></text></g><g class="actor"><rect width="48.813" height="37.6" x="10" y="1013.2" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="20" y="1036.8" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="20">App</tspan></text></g><line x1="34.406" x2="34.406" y1="57.6" y2="1013.2" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="164.025" height="37.6" x="252.044" y="20" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="262.044" y="43.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="262.044">ANGLE Front-end</tspan></text></g><g class="actor"><rect width="164.025" height="37.6" x="252.044" y="1013.2" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="262.044" y="1036.8" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="262.044">ANGLE Front-end</tspan></text></g><line x1="334.056" x2="334.056" y1="57.6" y2="1013.2" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="164.025" height="37.6" x="522.881" y="20" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="532.881" y="43.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="532.881">Vulkan Back-end</tspan></text></g><g class="actor"><rect width="164.025" height="37.6" x="522.881" y="1013.2" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="532.881" y="1036.8" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="532.881">Vulkan Back-end</tspan></text></g><line x1="604.894" x2="604.894" y1="57.6" y2="1013.2" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="173.625" height="37.6" x="808.131" y="20" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="818.131" y="43.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="818.131">ANGLE Translator</tspan></text></g><g class="actor"><rect width="173.625" height="37.6" x="808.131" y="1013.2" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="818.131" y="1036.8" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="818.131">ANGLE Translator</tspan></text></g><line x1="894.944" x2="894.944" y1="57.6" y2="1013.2" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="288.85" height="37.6" x="1001.756" y="20" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="1011.756" y="43.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1011.756">Link-Time SPIR-V Transformer</tspan></text></g><g class="actor"><rect width="288.85" height="37.6" x="1001.756" y="1013.2" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="1011.756" y="1036.8" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1011.756">Link-Time SPIR-V Transformer</tspan></text></g><line x1="1146.181" x2="1146.181" y1="57.6" y2="1013.2" fill="none" stroke="#000" style="stroke-width:2"/><g class="signal"><text x="88.213" y="87.4" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="88.213">glCompileShader (VS)</tspan></text><line x1="34.406" x2="334.056" y1="95.2" y2="95.2" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="387.856" y="125" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="387.856">ShaderVk::compile</tspan></text><line x1="334.056" x2="604.894" y1="132.8" y2="132.8" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="697.106" y="162.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="697.106">sh::Compile</tspan></text><line x1="604.894" x2="894.944" y1="170.4" y2="170.4" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="552.088" y="200.2" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="552.088">return SPIR-V</tspan></text><line x1="894.944" x2="334.056" y1="208" y2="208" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="230.838" height="66" x="354.056" y="228" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="359.056" y="246.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="359.056">SPIR-V is using bogus</tspan><tspan x="359.056" dy="1.2em">decorations to be</tspan><tspan x="359.056" dy="1.2em">corrected at link time.</tspan></text></g><g class="note"><rect width="230.838" height="27.6" x="54.406" y="314" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="59.406" y="332.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="59.406">Same for FS, GS, etc...</tspan></text></g><g class="signal"><text x="83.413" y="371.4" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="83.413">glCreateProgram (...)</tspan></text><line x1="34.406" x2="334.056" y1="379.2" y2="379.2" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="88.213" y="409" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="88.213">glAttachShader (...)</tspan></text><line x1="34.406" x2="334.056" y1="416.8" y2="416.8" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="121.819" y="446.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="121.819">glLinkProgram</tspan></text><line x1="34.406" x2="334.056" y1="454.4" y2="454.4" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="397.463" y="484.2" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="397.463">ProgramVk::link</tspan></text><line x1="334.056" x2="604.894" y1="492" y2="492" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="250.05" height="46.8" x="624.894" y="512" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="629.894" y="530.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="629.894">ProgramVk inits uniforms,</tspan><tspan x="629.894" dy="1.2em">layouts, and descriptors.</tspan></text></g><g class="signal"><text x="774.719" y="588.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="774.719">SpvGetShaderSpirvCode</tspan></text><line x1="604.894" x2="1146.181" y1="596.4" y2="596.4" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="678.7" y="626.2" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="678.7">retrieve SPIR-V and determine decorations</tspan></text><line x1="1146.181" x2="604.894" y1="634" y2="634" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="402.263" y="663.8" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="402.263">return success</tspan></text><line x1="604.894" x2="334.056" y1="671.6" y2="671.6" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="259.65" height="27.6" x="54.406" y="691.6" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="59.406" y="710.2" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="59.406">App execution continues...</tspan></text></g><g class="signal"><text x="73.813" y="749" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="73.813">glDrawArrays (any draw)</tspan></text><line x1="34.406" x2="334.056" y1="756.8" y2="756.8" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="368.656" y="786.6" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="368.656">ContextVk::drawArrays</tspan></text><line x1="334.056" x2="604.894" y1="794.4" y2="794.4" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="774.719" y="824.2" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="774.719">SpvTransformSpirvCode</tspan></text><line x1="604.894" x2="1146.181" y1="832" y2="832" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="755.513" y="861.8" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="755.513">return transformed SPIR-V</tspan></text><line x1="1146.181" x2="604.894" y1="869.6" y2="869.6" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="230.838" height="66" x="624.894" y="889.6" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="629.894" y="908.2" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="629.894">We init VkShaderModules</tspan><tspan x="629.894" dy="1.2em">and VkPipeline then</tspan><tspan x="629.894" dy="1.2em">record the draw.</tspan></text></g><g class="signal"><text x="402.263" y="985.4" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="402.263">return success</tspan></text><line x1="604.894" x2="334.056" y1="993.2" y2="993.2" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g></svg>